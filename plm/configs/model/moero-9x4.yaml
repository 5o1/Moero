model:
  class_path: plm.models.Cmr25Module
  init_args:

    optimizer_init_kwargs:
      lr: 0.0002
      weight_decay: 1e-2

    model:
      class_path: models.Moero
      init_args:
        senseblock_kwargs:
          use_noise: true
        csmblock_kwargs:
          crop: false
        nbranch: &nbranch 4

        branchnav:
          class_path: models.modules.nav.KmeansBranchNav
          init_args:
            in_channels: &word_length 1024
            n_components: *nbranch
            buffer_maxsize: 2048
            buffer_nskip: 7000
            ckpt_bias: -2 # Equals to `(buffer_maxsize // n_ddp_ranks) * n_ddp_ranks - buffer_maxsize`
            
        csm_model:
          class_path: models.PromptVQUnet
          init_args:
            in_channels: 10
            out_channels: 10
            pyramid_channels: [20, 30, 40, 50]
            prompt_tokens: [8, 8, 8, *word_length]
            prompt_channels: [10, 16, 24, 30]
            prompt_figsize: [64, 32, 16]
            n_enc_cab: [2, 3, 3]
            n_dec_cab: [2, 2, 3]
            n_skip_cab: [1, 1, 1, 3]
            reduction: 1
            norm: false
            bias: false
            idx_cascade: null
            
        cascades: 
          - class_path: models.PromptVQUnet
            init_args: &cascadebase
              in_channels: 50
              out_channels: 50
              pyramid_channels: [40, 60, 80, 100]
              prompt_tokens: [8, 8, 8, *word_length]
              prompt_channels: [20, 40, 60, 60]
              prompt_figsize: [64, 32, 16]
              n_enc_cab: [2, 3, 3]
              n_dec_cab: [2, 2, 3]
              n_skip_cab: [1, 1, 1, 3]
              reduction: 1
              n_history: 9
              idx_cascade: 0
          - class_path: models.PromptVQUnet
            init_args:
              <<: *cascadebase
              idx_cascade: 1
          - class_path: models.PromptVQUnet
            init_args:
              <<: *cascadebase
              idx_cascade: 2
          - class_path: models.PromptVQUnet
            init_args:
              <<: *cascadebase
              idx_cascade: 3
          - class_path: models.PromptVQUnet
            init_args:
              <<: *cascadebase
              idx_cascade: 4
          - class_path: models.PromptVQUnet
            init_args:
              <<: *cascadebase
              idx_cascade: 5
          - class_path: models.PromptVQUnet
            init_args:
              <<: *cascadebase
              idx_cascade: 6
          - class_path: models.PromptVQUnet
            init_args:
              <<: *cascadebase
              idx_cascade: 7
          - class_path: models.PromptVQUnet
            init_args:
              <<: *cascadebase
              idx_cascade: 8